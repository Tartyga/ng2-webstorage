!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],t):t(e.ng2Webstorage=e.ng2Webstorage||{},e.ng.core)}(this,function(e,n){"use strict";var o,t;(t=o||(o={}))[t.local=0]="local",t[t.session=1]="session";var r,i="ng2-webstorage",s=((r={})[o.local]="local",r[o.session]="session",r),a=i,u="|",c=!1;function f(e){return 0===e.indexOf(a+u)}var l,g,v,p,y=function(){function e(){}return e.isManagedKey=function(e){return 0===e.indexOf(a+u)},e.retrieveKeysFromStorage=function(e){return Object.keys(e).filter(f)},e.genKey=function(e){if("string"!=typeof e)throw Error("attempt to generate a storage key with a non string value");return""+a+u+this.formatKey(e)},e.formatKey=function(e){var t=e.toString();return c?t:t.toLowerCase()},e.setStorageKeyPrefix=function(e){void 0===e&&(e=i),a=e},e.setCaseSensitivity=function(e){void 0===e&&(e=!1),c=e},e.setStorageKeySeparator=function(e){void 0===e&&(e="|"),u=e},e}(),S=function(){function e(){}return e.observe=function(e,t){var r=this.genObserverKey(e,t);return r in this.observers?this.observers[r]:this.observers[r]=new n.EventEmitter},e.emit=function(e,t,r){var n=this.genObserverKey(e,t);n in this.observers&&this.observers[n].emit(r)},e.genObserverKey=function(e,t){return e+"|"+t},e.initStorage=function(){e.storageInitStream.emit(!0)},e.observers={},e.storageInitStream=new n.EventEmitter,e.storageInit$=e.storageInitStream.asObservable(),e}(),d=function(){function r(){}return r.isSecuredField=function(e){return!!~r.securedFields.indexOf(e)},r.getStorage=function(e){return this.mockStorages[e]||(this.mockStorages[e]=r.generateStorage()),this.mockStorages[e]},r.generateStorage=function(){var e={};return Object.defineProperties(e,{setItem:{writable:!1,enumerable:!1,configurable:!1,value:function(e,t){r.isSecuredField(e)||(this[e]=t)}},getItem:{writable:!1,enumerable:!1,configurable:!1,value:function(e){return r.isSecuredField(e)?null:this[e]||null}},removeItem:{writable:!1,enumerable:!1,configurable:!1,value:function(e){r.isSecuredField(e)||delete this[e]}},length:{enumerable:!1,configurable:!1,get:function(){return Object.keys(this).length}}}),e},r.securedFields=["setItem","getItem","removeItem","length"],r.mockStorages={},r}(),h=((l={})[o.local]={},l[o.session]={},l),b=((g={})[o.local]=null,g[o.session]=null,g),m=function(){function n(){}return n.store=function(e,t,r,n){void 0===n&&(n=!0),this.getStorage(e).setItem(t,n?JSON.stringify(r):r),h[e][t]=r,S.emit(e,t,r)},n.retrieve=function(e,t){if(t in h[e])return h[e][t];var r=n.retrieveFromStorage(e,t);return null!==r&&(h[e][t]=r),r},n.retrieveFromStorage=function(e,t){var r=null;try{r=JSON.parse(this.getStorage(e).getItem(t))}catch(e){console.warn("invalid value for "+t)}return r},n.refresh=function(e,t){if(y.isManagedKey(t)){var r=n.retrieveFromStorage(e,t);null===r?(delete h[e][t],S.emit(e,t,null)):r!==h[e][t]&&(h[e][t]=r,S.emit(e,t,r))}},n.refreshAll=function(t){Object.keys(h[t]).forEach(function(e){return n.refresh(t,e)})},n.clearAll=function(t){var r=this.getStorage(t);y.retrieveKeysFromStorage(r).forEach(function(e){r.removeItem(e),delete h[t][e],S.emit(t,e,null)})},n.clear=function(e,t){this.getStorage(e).removeItem(t),delete h[e][t],S.emit(e,t,null)},n.getStorage=function(e){return this.isStorageAvailable(e)?this.getWStorage(e):d.getStorage(e)},n.getWStorage=function(e){var t;switch(e){case o.local:t=localStorage;break;case o.session:t=sessionStorage;break;default:throw Error("invalid storage type")}return t},n.isStorageAvailable=function(e){if("boolean"==typeof b[e])return b[e];var t,r=!0;try{"object"==typeof(t=this.getWStorage(e))?(t.setItem("test-storage","foobar"),t.removeItem("test-storage")):r=!1}catch(e){r=!1}return r||console.warn(s[e]+" storage unavailable, Ng2Webstorage will use a fallback strategy instead"),b[e]=r},n}(),O=function(){function e(e){void 0===e&&(e=null),this.sType=e,this.sType=e}return e.prototype.store=function(e,t,r){var n=y.genKey(e);m.store(this.sType,n,t,r)},e.prototype.retrieve=function(e){var t=y.genKey(e);return m.retrieve(this.sType,t)},e.prototype.clear=function(e){e?m.clear(this.sType,y.genKey(e)):m.clearAll(this.sType)},e.prototype.observe=function(e){var t=y.genKey(e);return S.observe(this.sType,t)},e.prototype.isStorageAvailable=function(){return m.isStorageAvailable(this.sType)},e}(),w=(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),I=function(e){function t(){return e.call(this,o.local)||this}return w(t,e),t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[]},t}(O),K=(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(e){function t(){return e.call(this,o.session)||this}return K(t,e),t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[]},t}(O),j=function(e){this.prefix=i,this.separator="|",this.caseSensitive=!1,e&&void 0!==e.prefix&&(this.prefix=e.prefix),e&&void 0!==e.separator&&(this.separator=e.separator),e&&void 0!==e.caseSensitive&&(this.caseSensitive=e.caseSensitive)};function k(e,r,t,n,o){var i=e||n;if(Object.defineProperty(t,n,{get:function(){var e=y.genKey(i);return m.retrieve(r,e)},set:function(e){var t=y.genKey(i);this[t]=e,m.store(r,t,e)}}),null===t[n]&&void 0!==o)var s=S.storageInit$.subscribe(function(){t[n]=o,s.unsubscribe()})}var F=new n.InjectionToken("WEBSTORAGE_CONFIG"),x=function(){function t(e,t){this.ngZone=e,t&&(y.setStorageKeyPrefix(t.prefix),y.setStorageKeySeparator(t.separator),y.setCaseSensitivity(t.caseSensitive)),this.initStorageListener(),S.initStorage()}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:F,useValue:e},{provide:j,useFactory:A,deps:[F]}]}},t.prototype.initStorageListener=function(){var e=this;"undefined"!=typeof window&&window.addEventListener("storage",function(t){return e.ngZone.run(function(){var e=window.sessionStorage===t.storageArea?o.session:o.local;null===t.key?m.refreshAll(e):m.refresh(e,t.key)})})},t.decorators=[{type:n.NgModule,args:[{declarations:[],providers:[_,I],imports:[]}]}],t.ctorParameters=function(){return[{type:n.NgZone},{type:j,decorators:[{type:n.Optional},{type:n.Inject,args:[j]}]}]},t}();function A(e){return new j(e)}e.WEBSTORAGE_CONFIG=F,e.Ng2Webstorage=x,e.provideConfig=A,e.WebstorageConfig=j,e.LocalStorage=function(r,n){return function(e,t){k(r,o.local,e,t,n)}},e.SessionStorage=function(r,n){return function(e,t){k(r,o.session,e,t,n)}},e.WebStorage=function(r,n,o){return void 0===o&&(o=null),function(e,t){k(r,n,e,t,o)}},e.WebStorageDecorator=k,e.WebStorageService=O,e.LocalStorageService=I,e.SessionStorageService=_,Object.defineProperty(e,"__esModule",{value:!0})});